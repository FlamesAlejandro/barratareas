"use strict";var Usuarios=require("../Models/Usuarios"),enviarEmail=require("../handlers/email");exports.formCrearCuenta=function(e,r){r.render("crearCuenta",{nombrePagina:"Crear cuenta"})},exports.formIniciarSesion=function(e,r){var a=r.locals.mensajes.error;r.render("iniciarSesion",{nombrePagina:"Iniciar Sesión",error:a})},exports.crearCuenta=function(r,a){var n,t,s,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,t=n.email,s=n.password,e.prev=1,e.next=4,regeneratorRuntime.awrap(Usuarios.create({email:t,password:s}));case 4:return o="http://".concat(r.headers.host,"/confirmar/").concat(t),i={email:t},e.next=8,regeneratorRuntime.awrap(enviarEmail.enviar({usuario:i,subject:"Confirmar tu Cuenta",confirmarUrl:o,archivo:"confirmar-cuenta"}));case 8:r.flash("correcto","Envíamos un correo"),a.redirect("/iniciar-sesion"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),r.flash("error",e.t0.errors.map(function(e){return e.message})),a.render("crearCuenta",{mensajes:r.flash(),nombrePagina:"Crear Cuenta",email:t,password:s});case 16:case"end":return e.stop()}},null,null,[[1,12]])},exports.formRestablecerPassword=function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r.render("reestablecer",{nombrePagina:"Reestablecer contraseña"});case 1:case"end":return e.stop()}})},exports.confirmarCuenta=function(r,a){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Usuario.findOne({where:{email:r.params.correo}}));case 2:return n=e.sent,r.flash("error","Cuenta no valida"),a.redirect("crear-cuenta"),n.activo=1,e.next=8,regeneratorRuntime.awrap(n.save());case 8:r.flash("correcto","Cuenta Activada"),a.redirect("/iniciar-sesion");case 10:case"end":return e.stop()}})};