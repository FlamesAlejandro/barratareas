"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],o=!0,n=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done)&&(t.push(s.value),!r||t.length!==r);o=!0);}catch(e){n=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(n)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var Proyectos=require("../models/Proyectos"),Tareas=require("../Models/Tareas"),slug=require("slug");exports.proyectosHome=function(e,r){var t,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.locals.usuario.id,e.next=3,regeneratorRuntime.awrap(Proyectos.findAll({where:{usuarioId:t}}));case 3:o=e.sent,console.log(o),r.render("index",{nombrePagina:"Proyectos",proyectos:o});case 6:case"end":return e.stop()}})},exports.formularioProyecto=function(e,r){var t,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.locals.usuario.id,e.next=3,regeneratorRuntime.awrap(Proyectos.findAll({where:{usuarioId:t}}));case 3:o=e.sent,r.render("nuevoProyecto",{nombrePagina:"Nuevo Proyecto",proyectos:o});case 5:case"end":return e.stop()}})},exports.nuevoProyecto=function(r,t){var o,n,a,s,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.locals.usuario.id,e.next=3,regeneratorRuntime.awrap(Proyectos.findAll({where:{usuarioId:o}}));case 3:if(n=e.sent,a=r.body.nombre,s=[],a||s.push({texto:"Agrega un nombre el proyecto"}),!(0<s.length)){e.next=11;break}t.render("nuevoProyecto",{nombrePagina:"Nuevo Proyecto",errores:s,proyectos:n}),e.next=15;break;case 11:return c=t.locals.usuario.id,e.next=14,regeneratorRuntime.awrap(Proyectos.create({nombre:a,usuarioId:c}));case 14:t.redirect("/");case 15:case"end":return e.stop()}})},exports.proyectoPorUrl=function(r,t){var o,n,a,s,c,u,i,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.locals.usuario.id,n=Proyectos.findAll({where:{usuarioId:o}}),a=Proyectos.findOne({where:{url:r.params.url,usuarioId:o}}),e.next=6,regeneratorRuntime.awrap(Promise.all([n,a]));case 6:return s=e.sent,c=_slicedToArray(s,2),u=c[0],i=c[1],e.next=12,regeneratorRuntime.awrap(Tareas.findAll({where:{proyectoId:i.id}}));case 12:if(l=e.sent,i){e.next=15;break}return e.abrupt("return",next());case 15:t.render("tareas",{nombrePagina:"Tareas del Proyecto",proyecto:i,proyectos:u,tareas:l});case 16:case"end":return e.stop()}})},exports.formularioEditar=function(r,t){var o,n,a,s,c,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.locals.usuario.id,n=Proyectos.findAll({where:{usuarioId:o}}),a=Proyectos.findOne({where:{id:r.params.id,usuarioId:o}}),e.next=5,regeneratorRuntime.awrap(Promise.all([n,a]));case 5:s=e.sent,c=_slicedToArray(s,2),u=c[0],i=c[1],t.render("nuevoProyecto",{nombrePagina:"Editar Proyecto",proyecto:i,proyectos:u});case 10:case"end":return e.stop()}})},exports.actualizarProyecto=function(r,t){var o,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.body.nombre,e.next=3,regeneratorRuntime.awrap(Proyectos.findAll());case 3:if(n=e.sent,a=[],o||a.push({texto:"Agrega un nombre el proyecto"}),!(0<a.length)){e.next=10;break}t.render("nuevoProyecto",{nombrePagina:"Nuevo Proyecto",errores:a,proyectos:n}),e.next=13;break;case 10:return e.next=12,regeneratorRuntime.awrap(Proyectos.update({nombre:o},{where:{id:r.params.id}}));case 12:t.redirect("/");case 13:case"end":return e.stop()}})},exports.eliminarProyecto=function(r,t,o){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.query.urlProyecto,e.next=3,regeneratorRuntime.awrap(Proyectos.destroy({where:{url:n}}));case 3:if(e.sent){e.next=6;break}return e.abrupt("return",o());case 6:t.status(200).send("Proyecto eliminado correctamente.");case 7:case"end":return e.stop()}})};